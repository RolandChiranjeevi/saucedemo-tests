name: Selenium Tests - DEBUG MODE

on:
  push:
    branches: [ main ]
  repository_dispatch:
    types: [deployment-completed]

jobs:
  debug_test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Environment Check
      run: |
        echo "ğŸ” === INITIAL ENVIRONMENT DEBUG ==="
        echo "PWD: $(pwd)"
        echo "USER: $(whoami)"
        echo "HOME: $HOME"
        echo "PATH: $PATH"
        echo "Working directory contents:"
        ls -la
        echo "Git version:"
        git --version
        echo "=== END INITIAL DEBUG ==="
        
    - name: Simple Git Clone Test
      run: |
        echo "ğŸ“¥ Testing simple git clone..."
        git clone https://github.com/RolandChiranjeevi/saucedemo-tests.git /tmp/test-repo
        echo "âœ… Clone succeeded to /tmp/test-repo"
        ls -la /tmp/test-repo
        
    - name: Copy Files to Workspace
      run: |
        echo "ğŸ“ Copying files to workspace..."
        cp -r /tmp/test-repo/* . || echo "No files to copy"
        cp -r /tmp/test-repo/.* . 2>/dev/null || echo "No hidden files to copy"
        echo "âœ… Files copied, current directory:"
        ls -la
        
    - name: Check Package.json
      run: |
        echo "ğŸ“¦ Checking package.json..."
        if [ -f package.json ]; then
          echo "âœ… package.json found"
          cat package.json
        else
          echo "âŒ package.json not found!"
          exit 1
        fi
        
    - name: Node.js Check
      run: |
        echo "ğŸ”§ Checking Node.js..."
        which node || echo "Node not found"
        node --version || echo "Node version failed"
        which npm || echo "NPM not found"
        npm --version || echo "NPM version failed"
        
    - name: Simple NPM Install Test
      run: |
        echo "ğŸ“¦ Testing npm ci..."
        npm ci || echo "NPM CI failed"
        echo "âœ… Dependencies check:"
        ls -la node_modules/ | head -10
        
  notification:
    needs: debug_test
    runs-on: ubuntu-latest
    if: always()
    
    steps:
    - name: Debug Results Summary
      run: |
        if [ "${{ needs.debug_test.result }}" == "success" ]; then
          echo "âœ… Debug-testerna lyckades!"
          echo "Environment och setup fungerar."
        else
          echo "âŒ Debug-testerna misslyckades!"
          echo "BehÃ¶ver analysera vilken del som failar."
        fi
